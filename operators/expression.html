<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js geo-engine">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Expression - Geo Engine Docs</title>
                

        <!-- Custom HTML head -->
        

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

                <link rel="icon" href="../favicon.svg">
                        <link rel="shortcut icon" href="../favicon.png">
                <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
                <link rel="stylesheet" href="../css/print.css" media="print">
        
        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
                <link rel="stylesheet" href="../fonts/fonts.css">
        
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        
                <!-- MathJax -->
        <script async type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
            </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "geo-engine" : "geo-engine";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('geo-engine')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            
            <div class="sidebar-scrollbox">
                <!-- TODO: Replace with standard functionality: https://github.com/rust-lang/mdBook/pull/1584 -->
                <div class="sidebar-book-logo">
                    <img src="../images/geoengine-web.svg" alt="Geo Engine">
                </div>
                <ol class="chapter"><li class="chapter-item expanded "><a href="../welcome.html"><strong aria-hidden="true">1.</strong> Welcome to Geo Engine Docs</a></li><li class="chapter-item expanded "><a href="../geoengine/intro.html"><strong aria-hidden="true">2.</strong> The Geo Engine</a></li><li><ol class="section"><li class="chapter-item expanded "><div><strong aria-hidden="true">2.1.</strong> Engine</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">2.2.</strong> Workflows</div></li></ol></li><li class="chapter-item expanded "><a href="../api/intro.html"><strong aria-hidden="true">3.</strong> API</a></li><li><ol class="section"><li class="chapter-item expanded "><div><strong aria-hidden="true">3.1.</strong> Datasets</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">3.2.</strong> Projects</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">3.3.</strong> Upload</div></li><li class="chapter-item expanded "><a href="../api/workflows.html"><strong aria-hidden="true">3.4.</strong> Workflows</a></li></ol></li><li class="chapter-item expanded "><a href="../datatypes/intro.html"><strong aria-hidden="true">4.</strong> Datatypes</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../datatypes/colorizer.html"><strong aria-hidden="true">4.1.</strong> Colorizer</a></li><li class="chapter-item expanded "><a href="../datatypes/measurement.html"><strong aria-hidden="true">4.2.</strong> Measurement</a></li><li class="chapter-item expanded "><a href="../datatypes/queryrectangle.html"><strong aria-hidden="true">4.3.</strong> QueryRectangle</a></li><li class="chapter-item expanded "><a href="../datatypes/rasterdatatype.html"><strong aria-hidden="true">4.4.</strong> RasterDataType</a></li><li class="chapter-item expanded "><a href="../datatypes/timeinstance.html"><strong aria-hidden="true">4.5.</strong> TimeInstance</a></li><li class="chapter-item expanded "><a href="../datatypes/timeinterval.html"><strong aria-hidden="true">4.6.</strong> TimeInterval</a></li><li class="chapter-item expanded "><a href="../datatypes/timestep.html"><strong aria-hidden="true">4.7.</strong> TimeStep</a></li></ol></li><li class="chapter-item expanded "><a href="../operators/intro.html"><strong aria-hidden="true">5.</strong> Operators</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../operators/columnrangefilter.html"><strong aria-hidden="true">5.1.</strong> ColumnRangeFilter</a></li><li class="chapter-item expanded "><a href="../operators/expression.html" class="active"><strong aria-hidden="true">5.2.</strong> Expression</a></li><li class="chapter-item expanded "><a href="../operators/gdalsource.html"><strong aria-hidden="true">5.3.</strong> GdalSource</a></li><li class="chapter-item expanded "><a href="../operators/interpolation.html"><strong aria-hidden="true">5.4.</strong> Interpolation</a></li><li class="chapter-item expanded "><a href="../operators/neighborhoodaggregate.html"><strong aria-hidden="true">5.5.</strong> NeighborhoodAggregate</a></li><li class="chapter-item expanded "><a href="../operators/ogrsource.html"><strong aria-hidden="true">5.6.</strong> OgrSource</a></li><li class="chapter-item expanded "><a href="../operators/pointinpolygon.html"><strong aria-hidden="true">5.7.</strong> PointInPolygon</a></li><li class="chapter-item expanded "><a href="../operators/rastertypeconversion.html"><strong aria-hidden="true">5.8.</strong> RasterTypeConversion</a></li><li class="chapter-item expanded "><a href="../operators/reprojection.html"><strong aria-hidden="true">5.9.</strong> Reprojection</a></li><li class="chapter-item expanded "><a href="../operators/temporalrasteraggregation.html"><strong aria-hidden="true">5.10.</strong> TemporalRasterAggregation</a></li><li class="chapter-item expanded "><a href="../operators/timeprojection.html"><strong aria-hidden="true">5.11.</strong> TimeProjection</a></li><li class="chapter-item expanded "><a href="../operators/timeshift.html"><strong aria-hidden="true">5.12.</strong> TimeShift</a></li><li class="chapter-item expanded "><a href="../operators/vectorjoin.html"><strong aria-hidden="true">5.13.</strong> VectorJoin</a></li><li class="chapter-item expanded "><a href="../operators/visualpointclustering.html"><strong aria-hidden="true">5.14.</strong> VisualPointClustering</a></li></ol></li><li class="chapter-item expanded "><a href="../plots/intro.html"><strong aria-hidden="true">6.</strong> Plots</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../plots/boxplot.html"><strong aria-hidden="true">6.1.</strong> BoxPlot</a></li><li class="chapter-item expanded "><a href="../plots/classHistogram.html"><strong aria-hidden="true">6.2.</strong> ClassHistogram</a></li><li class="chapter-item expanded "><a href="../plots/featureattributevaluesoverTime.html"><strong aria-hidden="true">6.3.</strong> FeatureAttributeValuesOverTime</a></li><li class="chapter-item expanded "><a href="../plots/histogram.html"><strong aria-hidden="true">6.4.</strong> Histogram</a></li><li class="chapter-item expanded "><a href="../plots/meanrasterpixelvaluesovertime.html"><strong aria-hidden="true">6.5.</strong> MeanRasterPixelValuesOverTime</a></li><li class="chapter-item expanded "><a href="../plots/scatterplot.html"><strong aria-hidden="true">6.6.</strong> ScatterPlot</a></li><li class="chapter-item expanded "><a href="../plots/statistics.html"><strong aria-hidden="true">6.7.</strong> Statistics</a></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">7.</strong> OGC Access</div></li><li><ol class="section"><li class="chapter-item expanded "><div><strong aria-hidden="true">7.1.</strong> WMS</div></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">8.</strong> Solutions</div></li><li><ol class="section"><li class="chapter-item expanded "><div><strong aria-hidden="true">8.1.</strong> Geo Engine Pro</div></li></ol></li></ol>                <ol class="chapter">
                    <li class="part-title">API Reference</li>
                    <li class="chapter-item">
                        <a href="https://python.docs.geoengine.io" style="width: 100%; display: flex; flex-direction: row;">
                            <span style="flex: 1;">Python</span>
                            <i class="fa fa-external-link" style="align-self: center;"></i>
                        </a>
                    </li>
                </ol>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <!-- TODO: include back if we have a dark theme -->
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list" style="display: none;">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                                                <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                                            </div>

                    <h1 class="menu-title">Geo Engine Docs</h1>

                    <div class="right-buttons">
                                                <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                                                                        
                    </div>
                </div>

                                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="raster-expression"><a class="header" href="#raster-expression">Raster Expression</a></h1>
<p>The <code>Expression</code> operator performs a pixel-wise mathematical expression on one or more raster sources.
The expression is specified as a user-defined script in a very simple language.
The output is a raster time series with the result of the expression and with time intervals that are the same as for the inputs.
Users can specify an output data type.
Internally, the expression is evaluated using floating-point numbers.</p>
<p>An example usage scenario is to calculate NDVI for a red and a near-infrared raster channel.
The expression uses two raster sources, referred to as A and B, and calculates the formula <code>(A - B) / (A + B)</code>.
When the temporal resolution is months, our output NDVI will also be a monthly time series.</p>
<h2 id="parameters"><a class="header" href="#parameters">Parameters</a></h2>
<table><thead><tr><th>Parameter</th><th>Type</th><th>Description</th><th>Example Value</th></tr></thead><tbody>
<tr><td><code>expression</code></td><td><code>Expression</code></td><td>Expression script</td><td><pre><code>(A - B) / (A + B)</code></pre></td></tr>
<tr><td><code>outputType</code></td><td><a href="/datatypes/rasterdatatype.html"><code>RasterDataType</code></a></td><td>A raster data type for the output</td><td><pre><code>U8</code></pre></td></tr>
<tr><td><code>outputMeasurement</code></td><td><a href="/datatypes/measurement.html"><code>Measurement</code></a></td><td>Description about the output</td><td><pre><code>{<br>  &quot;type&quot;: &quot;continuous&quot;,<br>  &quot;measurement&quot;: &quot;NDVI&quot;<br>}</code></pre></td></tr>
<tr><td><code>mapNoData</code></td><td><code>bool</code></td><td>Should NO DATA values be mapped with the <code>expression</code>? Otherwise, they are mapped automatically to NO DATA.</td><td><pre><code>false</code></pre></td></tr>
</tbody></table>
<h2 id="types"><a class="header" href="#types">Types</a></h2>
<p>The following describes the types used in the parameters.</p>
<h3 id="expression"><a class="header" href="#expression">Expression</a></h3>
<p>Expressions are simple scripts to perform pixel-wise computations.
One can refer to the raster inputs as <code>A</code> for the first raster, <code>B</code> for the second, and so on.
Furthermore, expressions can check with <code>A IS NODATA</code>, <code>B IS NODATA</code>, etc. for NO DATA values.
This is important if <code>mapNoData</code> is set to true.
Otherwise, NO DATA values are mapped automatically to the output NO DATA value.
Finally, the value <code>NODATA</code> can be used to output NO DATA.</p>
<p>Users can think of this implicit function signature for, e.g., two inputs:</p>
<pre><code class="language-Rust">fn (A: f64, B: f64) -&gt; f64
</code></pre>
<p>As a start, expressions contain algebraic operations and mathematical functions.</p>
<pre><code class="language-Rust">(A + B) / 2
</code></pre>
<p>In addition, branches can be used to check for conditions.</p>
<pre><code class="language-Rust">if A IS NODATA {
    B
} else {
    A
}
</code></pre>
<p>Function calls can be used to access utility functions.</p>
<pre><code class="language-Rust">max(A, 0)
</code></pre>
<p>Currently, the following functions are available:</p>
<ul>
<li><code>abs(a)</code>: absolute value</li>
<li><code>min(a, b)</code>, <code>min(a, b, c)</code>: minimum value</li>
<li><code>max(a, b)</code>, <code>max(a, b, c)</code>: maximum value</li>
<li><code>sqrt(a)</code>: square root</li>
<li><code>ln(a)</code>: natural logarithm</li>
<li><code>log10(a)</code>: base 10 logarithm</li>
<li><code>cos(a)</code>, <code>sin(a)</code>, <code>tan(a)</code>, <code>acos(a)</code>, <code>asin(a)</code>, <code>atan(a)</code>: trigonometric functions</li>
<li><code>pi()</code>, <code>e()</code>: mathematical constants</li>
<li><code>round(a)</code>, <code>ceil(a)</code>, <code>floor(a)</code>: rounding functions</li>
<li><code>mod(a, b)</code>: division remainder</li>
<li><code>to_degrees(a)</code>, <code>to_radians(a)</code>: conversion to degrees or radians</li>
</ul>
<p>To generate more complex expressions, it is possible to have variable assignments.</p>
<pre><code class="language-Rust">let mean = (A + B) / 2;
let coefficient = 0.357;
mean * coefficient
</code></pre>
<p>Note, that all assignments are separated by semicolons.
However, the last expression must be without a semicolon.</p>
<h2 id="inputs"><a class="header" href="#inputs">Inputs</a></h2>
<p>The <code>Expression</code> operator expects one to eight <em>raster</em> inputs.</p>
<table><thead><tr><th>Parameter</th><th>Type</th></tr></thead><tbody>
<tr><td><code>A</code></td><td><code>SingleRasterSource</code></td></tr>
<tr><td><code>B</code></td><td><code>SingleRasterSource</code></td></tr>
<tr><td><code>C</code></td><td><code>SingleRasterSource</code></td></tr>
<tr><td>…</td><td><code>SingleRasterSource</code></td></tr>
</tbody></table>
<h2 id="errors"><a class="header" href="#errors">Errors</a></h2>
<p>The parsing of the expression can fail if there are, e.g., syntax errors.</p>
<h2 id="example-json"><a class="header" href="#example-json">Example JSON</a></h2>
<pre><code class="language-json">{
  &quot;type&quot;: &quot;Expression&quot;,
  &quot;params&quot;: {
    &quot;expression&quot;: &quot;(A - B) / (A + B)&quot;,
    &quot;outputType&quot;: &quot;F32&quot;,
    &quot;mapNoData&quot;: false
  },
  &quot;sources&quot;: {
    &quot;A&quot;: {
      &quot;type&quot;: &quot;GdalSource&quot;,
      &quot;params&quot;: {
        &quot;data&quot;: {
          &quot;type&quot;: &quot;internal&quot;,
          &quot;datasetId&quot;: &quot;a626c880-1c41-489b-9e19-9596d129859c&quot;
        }
      }
    },
    &quot;B&quot;: {
      &quot;type&quot;: &quot;GdalSource&quot;,
      &quot;params&quot;: {
        &quot;data&quot;: {
          &quot;type&quot;: &quot;internal&quot;,
          &quot;datasetId&quot;: &quot;699b9e14-4bd6-4d57-889a-58f60288b19c&quot;
        }
      }
    }
  }
}
</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                                                    <a rel="prev" href="../operators/columnrangefilter.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        
                                                    <a rel="next" href="../operators/gdalsource.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                                    <a rel="prev" href="../operators/columnrangefilter.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                
                                    <a rel="next" href="../operators/gdalsource.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                            </nav>

        </div>

        
        
        
                <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        
        
                <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>
        
        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        
        
    </body>
</html>
